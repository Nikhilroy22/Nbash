name: Build OpenJDK 17 for ARMv7 (Android)

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  build-openjdk:
    runs-on: ubuntu-latest

    steps:
      - name: 📁 Checkout termux-packages
        uses: actions/checkout@v3
        with:
          repository: termux/termux-packages
          path: termux-packages

      - name: 🧰 Install dependencies
        run: |
          sudo apt update
          sudo apt install -y git curl tar zip unzip \
            build-essential python3 texinfo \
            automake autoconf libtool libtool-bin \
            cmake pkg-config

      - name: 🐳 Setup Termux Docker builder
        run: |
          cd termux-packages
          ./scripts/setup-termux.sh

      - name: 🏗️ Build OpenJDK 17 for ARM
        run: |
          cd termux-packages
          ./scripts/run-docker.sh ./build-package.sh openjdk-17

      - name: 📤 Upload built .deb package
        uses: actions/upload-artifact@v4
        with:
          name: openjdk-17-armv7
          path: termux-packages/output/*.deb