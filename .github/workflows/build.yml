name: Build Nano .deb for ARMv7

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  build-nano-deb:
    runs-on: ubuntu-latest

    steps:
      - name: প্রয়োজনীয় প্যাকেজ ইনস্টল করুন
        run: |
          sudo apt update
          sudo apt install -y gcc-arm-linux-gnueabihf g++-arm-linux-gnueabihf \
              make autoconf automake libtool pkg-config gettext fakeroot \
              libncurses5-dev libncursesw5-dev curl dpkg-dev

      - name: Nano সোর্স কোড ডাউনলোড করুন
        run: |
          curl -LO https://www.nano-editor.org/dist/v7/nano-7.2.tar.xz
          tar -xf nano-7.2.tar.xz

      - name: Nano কম্পাইল ও প্যাকেজ তৈরি (.deb)
        run: |
          cd nano-7.2

          # build path
          mkdir -p build-armv7/usr/bin
          mkdir -p build-armv7/DEBIAN

          # nano configure and build
          ./configure \
            --host=arm-linux-gnueabihf \
            --prefix=/usr \
            --disable-nls \
            CC=arm-linux-gnueabihf-gcc \
            CXX=arm-linux-gnueabihf-g++

          make -j$(nproc)
          make DESTDIR=$PWD/build-armv7 install

          # create control file for DEB package
          cat <<EOF > build-armv7/DEBIAN/control
Package: nano-armv7
Version: 7.2
Architecture: armhf
Maintainer: Nikhil Roy <you@example.com>
Description: Nano Text Editor for ARMv7
Section: editors
Priority: optional
      EOF

          # b--build build-armv7 nano-a.deb
          - name: .deb ফাইল আপলোড করুন
            uses: actions/upload-artifact@v4
        with:
          name: nano-armv7-deb
          path: nano-7.2/nano-armv7.deb