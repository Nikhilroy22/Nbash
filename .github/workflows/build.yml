name: Build Termux Package

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: কোড ক্লোন করুন (termux-packages)
      run: |
        git clone https://github.com/termux/termux-packages
        cd termux-packages
        git submodule update --init --recursive

    - name: প্রয়োজনীয় প্যাকেজ ইনস্টল করুন
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          build-essential clang curl git \
          gnupg gperf cmake ninja-build \
          libncurses5-dev libtool \
          patch unzip zip \
          automake bison python3 \
          libxml2-utils xsltproc \
          ruby

    - name: Docker-এ Termux build environment রান করুন
      run: |
        cd termux-packages
        ./scripts/setup-termux.sh

    - name: নির্দিষ্ট প্যাকেজ build করুন (curl উদাহরণ)
      run: |
        cd termux-packages
        ./build-package.sh -a aarch64 -I curl

    - name: Artifact আর্কাইভ করুন
      run: |
        mkdir -p output
        cp -r termux-packages/output/* output/

    - name: Artifact আপলোড করুন
      uses: actions/upload-artifact@v4
      with:
        name: termux-debs
        path: output/