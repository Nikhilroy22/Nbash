name: Build ARMv7 Toolchain

on:
  workflow_dispatch:

jobs:
  build-toolchain:
    runs-on: ubuntu-latest

    steps:
    - name: কোড ক্লোন করুন
      uses: actions/checkout@v4

    - name: প্রয়োজনীয় প্যাকেজ ইনস্টল
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          git help2man gperf bison flex texinfo \
          libtool-bin automake libncurses5-dev python3-dev \
          gawk libexpat1-dev unzip build-essential wget

    - name: Crosstool-NG ডাউনলোড ও ইনস্টল
      run: |
        git clone https://github.com/crosstool-ng/crosstool-ng
        cd crosstool-ng
        ./bootstrap
        ./configure --enable-local
        make
        sudo make install
        ct-ng version

    - name: Toolchain config তৈরি করুন
      run: |
        mkdir -p toolchain-build
        cd toolchain-build
        ct-ng armv7a-unknown-linux-musleabi
        sed -i 's/^CT_PREFIX_DIR=.*/CT_PREFIX_DIR="${HOME}\/x-tools"/' .config
        ct-ng build

    - name: Toolchain আর্কাইভ করুন
      run: |
        cd ~/x-tools
        tar -czvf $GITHUB_WORKSPACE/armv7-toolchain.tar.gz *

    - name: Artifact আপলোড করুন
      uses: actions/upload-artifact@v4
      with:
        name: armv7-toolchain
        path: armv7-toolchain.tar.gz